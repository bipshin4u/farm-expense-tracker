<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oyster Farm Master Pro</title>
    <style>
        :root { --straw: #f1c40f; --spawn: #9b59b6; --yield: #2ecc71; --danger: #e74c3c; --dark: #2c3e50; --success: #27ae60; --forecast: #6c5ce7; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f0f2f5; margin: 0; color: var(--dark); padding-bottom: 30px; }
        .header-status { background: white; padding: 15px; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 100; text-align: center; }
        .forecast-banner { background: var(--forecast); color: white; padding: 12px; border-radius: 8px; margin: 10px 15px; font-size: 13px; }
        .tab-bar { display: flex; background: #eee; margin: 15px; border-radius: 10px; padding: 4px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; cursor: pointer; border-radius: 8px; font-size: 11px; color: #666; }
        .tab-btn.active { background: white; color: var(--dark); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .container { padding: 0 15px; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        button { background: var(--dark); color: white; border: none; font-weight: bold; cursor: pointer; }
        .stock-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .stock-item { padding: 8px; border-radius: 6px; background: #f8f9fa; border-left: 3px solid #ddd; font-size: 10px; line-height: 1.2; }
        .low-stock { border-left-color: var(--danger); background: #fff1f1; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        td, th { padding: 10px 5px; border-bottom: 1px solid #eee; text-align: left; }
        .action-btn { font-size: 16px; cursor: pointer; padding: 0 5px; }
        #editModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; }
        .modal-content { background:white; margin:15% auto; padding:20px; width:85%; border-radius:12px; }
        .ledger-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed #eee; font-size: 12px; }
    </style>
</head>
<body>

<div class="header-status">
    <div id="status" style="font-size:10px; color: var(--success); margin-bottom:5px;">‚úì Connected</div>
    <div class="grid">
        <div><small>Active Bags</small><div id="active-bags" style="font-weight:bold; font-size:1.1rem;">0</div></div>
        <div><small>Avg Yield/Bag</small><div id="yield-bag" style="font-weight:bold; font-size:1.1rem; color:var(--success)">0 kg</div></div>
    </div>
</div>

<div class="forecast-banner">
    <b>üîÆ 10-DAY FORECAST: <span id="fc-yield">0 kg</span></b>
    <div id="fc-msg" style="font-size:10px; opacity:0.9; margin-top:3px;">Based on your last 28 days of production.</div>
</div>

<div class="tab-bar">
    <button class="tab-btn active" onclick="openTab(event, 'tab-prod')">PRODUCTION</button>
    <button class="tab-btn" onclick="openTab(event, 'tab-fin')">FINANCE</button>
    <button class="tab-btn" onclick="openTab(event, 'tab-hist')">HISTORY</button>
</div>

<div class="container">
    <div id="tab-prod" class="tab-content">
        <div class="card">
            <h3 style="margin-top:0; font-size:14px;">üõ† Log Production</h3>
            <input type="number" id="f-qty" placeholder="Number of bags filled">
            <button onclick="addData('fill')" style="background:#1abc9c">Save Production</button>
            <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">
            <input type="number" step="0.1" id="y-weight" placeholder="Harvest Weight (kg)">
            <button onclick="addData('yield')" style="background:var(--yield)">Save Harvest</button>
        </div>
        <div class="card">
            <h3 style="margin:0 0 10px 0; font-size:14px;">üì¶ Stock Runway</h3>
            <div id="stock-display" class="stock-grid"></div>
        </div>
    </div>

    <div id="tab-fin" class="tab-content" style="display:none;">
        <div class="card grid" style="text-align:center;">
            <div><small>Total Sales</small><div id="sales-total" style="color:var(--success); font-weight:bold; font-size:1.1rem;">‚Çπ0</div></div>
            <div><small>Total Expenses</small><div id="exp-total" style="color:var(--danger); font-weight:bold; font-size:1.1rem;">‚Çπ0</div></div>
        </div>
        <div class="card">
            <select id="fin-type" onchange="toggleFin(this.value)">
                <option value="sale">Record New Sale</option>
                <option value="exp">Record New Expense</option>
            </select>
            <div id="div-sale">
                <input type="text" id="s-cust" placeholder="Customer Name">
                <input type="number" id="s-qty" placeholder="Punnets Sold">
                <input type="number" id="s-rate" placeholder="Rate per punnet (‚Çπ)">
                <button onclick="addData('sale')" style="background:var(--success)">Save Sale</button>
            </div>
            <div id="div-exp" style="display:none;">
                <select id="e-cat">
                    <optgroup label="Raw Materials">
                        <option value="Straw">Straw (kg)</option>
                        <option value="Spawn">Spawn (kg)</option>
                        <option value="Bavistine">Bavistine (g)</option>
                        <option value="Formalin">Formalin (ml)</option>
                        <option value="Punnets">Punnets (pcs)</option>
                    </optgroup>
                    <optgroup label="Staff Payments">
                        <option value="Worker: Pallavi Mavshi">Pallavi Mavshi</option>
                        <option value="Worker: Bhabhi">Bhabhi</option>
                        <option value="Worker: Sangeeta Mavshi">Sangeeta Mavshi</option>
                        <option value="Labor: General">General Labor</option>
                    </optgroup>
                    <optgroup label="Other">
                        <option value="Transport">Transport</option>
                        <option value="Misc">Misc</option>
                    </optgroup>
                </select>
                <input type="number" id="e-amt" placeholder="Total Amount (‚Çπ)">
                <input type="number" id="e-qty" placeholder="Quantity (kg/g/pcs)">
                <button onclick="addData('exp')" style="background:var(--danger)">Save Expense</button>
            </div>
        </div>
        <div class="card">
            <h3 style="margin:0 0 10px 0; font-size:14px;">üë©‚Äçüåæ Staff Payment Ledger</h3>
            <div id="worker-list"></div>
        </div>
    </div>

    <div id="tab-hist" class="tab-content" style="display:none;">
        <div class="card">
            <input type="text" id="h-search" placeholder="üîç Search History..." onkeyup="filterHistory()">
            <div style="max-height:400px; overflow-y:auto;">
                <table>
                    <thead><tr><th>Date</th><th>Detail</th><th>Amt/Qty</th><th>Action</th></tr></thead>
                    <tbody id="h-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="editModal">
    <div class="modal-content">
